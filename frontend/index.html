<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Milestone 2</title>
        <!-- 
            FRONTEND HTML FOR KUBERNETES WEBSTACK
            =====================================
            This page fetches data from the FastAPI backend and displays:
            1. The user name (from PostgreSQL database)
            2. The container ID (to demonstrate load balancing)
            
            WHY RELATIVE PATHS (/api/...)?
            - Using Ingress, both frontend and backend are served from the same domain
            - This avoids CORS issues and hardcoded URLs
            - The Ingress routes /api/* to the backend service
        -->
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                background: black;
                max-height: 100dvh;
                color: white;
            }

            #bg-img {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
                opacity: 0.5;
            }
            .container {
                background: rgba(216, 209, 187, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 40px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
            h1 {
                margin-bottom: 30px;
            }
            .info {
                background: rgba(199, 186, 155, 0.2);
                padding: 15px 25px;
                border-radius: 10px;
                margin: 15px 0;
                font-size: 1.1em;
            }
            .label {
                font-weight: bold;
                opacity: 0.8;
            }
            .value {
                font-family: monospace;
                background: rgba(0, 0, 0, 0.2);
                padding: 5px 10px;
                border-radius: 5px;
                margin-left: 10px;
            }
            .loading {
                opacity: 0.6;
                font-style: italic;
            }
            .error {
                color: #ff6b6b;
            }
        </style>
    </head>
    <body>
        <img id="bg-img" src="./assets/bg.webp" alt="background" />
        <div class="container">
            <h1>
                <span id="user" class="loading">Loading...</span> has finished
                milestone 2! Hip Hop Hooray!
            </h1>

            <div class="info">
                <span class="label">Container ID:</span>
                <span id="container-id" class="value loading">Loading...</span>
            </div>
            <div class="info">
                <span class="label">Health:</span>
                <span id="health" class="value loading">Loading...</span>
            </div>
            <div class="info">
                <form action="/api/user" method="put">
                    <input type="text" name="name" id="name" />
                    <button type="submit">Update Name</button>
                </form>
            </div>
        </div>

        <script>
            const userElement = document.getElementById("user");
            const containerElement = document.getElementById("container-id");
            const healthElement = document.getElementById("health");
            const title = "Milestone 2";

            fetch("/api/user")
                .then((res) => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then((data) => {
                    userElement.innerText = data.name;
                    userElement.classList.remove("loading");
                    document.title = title + " - " + data.name;
                })
                .catch((error) => {
                    console.error("Error fetching user:", error);
                    userElement.innerText = "Error";
                    userElement.classList.add("error");
                });

            fetch("/api/id")
                .then((res) => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then((data) => {
                    containerElement.innerText = data.id;
                    containerElement.classList.remove("loading");
                })
                .catch((error) => {
                    console.error("Error fetching container ID:", error);
                    containerElement.innerText = "Error";
                    containerElement.classList.add("error");
                });
            fetch("/api/health")
                .then((res) => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then((data) => {
                    healthElement.innerText = data.status;
                    healthElement.classList.remove("loading");
                })
                .catch((error) => {
                    healthElement.innerText = "Error";
                    healthElement.classList.add("error");
                });
        </script>
    </body>
</html>
